@{
    Layout = "";
    ViewBag.Title = "商城";
}
@using USP.Models.Entity;
@using USP.Models.POCO;;
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>商城</title>
    <meta name="description" content="Gulp.js 是一个自动化构建工具，开发者可以使用它在项目开发过程中自动执行常见任务。Gulp.js 是基于 Node.js 构建的，利用 Node.js 流的威力，你可以快速构建项目并减少频繁的 IO 操作。Gulp.js 源文件和你用来定义任务的 Gulp 文件都是通过 JavaScript（或者 CoffeeScript ）源码来实现的。">
    <meta name="keywords" content="Gulp.js,Gulp,Node.js,Node,JavaScript,CoffeeScript,Grunt,Gruntjs,Stream，流,自动化,Make">
    <meta name="author" content="gulp.js 中文网">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href="~/Static/Css/usp/usp.shop.css" rel="stylesheet" />
</head>

@*@section themes{
            <link href="~/Static/Css/usp/usp.shop.css" rel="stylesheet" />
    }*@


<body>

    <nav class="navbar  navbar-default navbar-fixed-top site-navbar">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand">啦啦啦</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    @*<li>
                            <a href="./">首页</a>
                        </li>*@
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">所有分类 <span class="caret"></span></a>
                        <input id="CommodityType" type="hidden" />
                        <ul class="dropdown-menu">
                            @{
                                foreach (var item in (List<CommodityType>)ViewBag.CommodityType)
                                {
                                    <li id="commodityType_@item.ID"><a href="javascript:setCommodityType('@item.ID')">@item.Name</a></li>
                                    <li role="separator" class="divider"></li>
                                }
                            }
                        </ul>
                    </li>
                </ul>

            </div>
        </div>
    </nav>

    @*<header class="jumbotron">
            <img class="hidden" src="" width="800" height="600">
            <h1><span class="text-hide">aaaaaaaa<span><img class="logo" src=""></span></span></h1>

        </header>*@




    <main class="container" style="margin-top:10px">
        <div class="row">
            @*-----------------左侧目录开始-----------------*@
            <div id="navleftbar" class="col-md-2" role="complementary" style="margin-top:5px; position:fixed">
                <input id="PromotionType" type="hidden" />
                <div class="list-group">
                    @{
                        for (int i = 0; i < ((List<SysDictionary>)ViewBag.LeftMenus).Count; i++)
                        {
                            <a id="promotionType_@ViewBag.LeftMenus[i].ID" href="javascript:setPromotionType('@ViewBag.LeftMenus[i].ID')" class="list-group-item">@ViewBag.LeftMenus[i].Name</a>
                        }
                    }
                </div>
            </div>
            @*-----------------左侧目录结束-----------------*@

            @*-----------------产品项开始-----------------*@
            <div id="products" class="row col-md-8 col-md-offset-2">

            </div>
            @*-----------------产品项结束-----------------*@

            @*-----------------右侧公告开始------------------*@
            <div id="rightInfo" class="col-md-2" role="complementary" style="margin-top:10px">
                <div class="list-group">
                    <li class="list-group-item">公告</li>
                    <li class="list-group-item">刘家良可以用“一代宗师”来形容，他出身武术世家，9岁开始随父亲学武，父亲刘湛是黄飞鸿入室弟子林世荣的亲传弟子，因此深得黄氏武学真传。之后更是进入电影界，参演执导电影无数，而且义薄云天，凭义气收获不少友情，更是获得获的金像奖终身成就奖纵横武术界与电影圈。</li>
                </div>
            </div>
            @*-----------------右侧公告结束-----------------*@
        </div>

    </main>


    <footer class="footer navbar-bottom">
        <div class="container ">
            <p>&copy;啦啦啦 中文网</p>
            <p><a href="#" target="_blank">京ICP备11008151号</a> | 京公网安备11010802014853</p>
        </div>
    </footer>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="http://cdn.bootcss.com/highlight.js/8.4/highlight.min.js"></script>
    <script src="http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    @Scripts.Render("~/Js/Usp")
    <script>
        hljs.initHighlightingOnLoad();
        var pageIndex = 1;
        var pageSize = 20;
        var commodityType = 0;
        var promotionType = 0;
        function setCommodityType(id) {
            $("#products").html("");
            if ($("#CommodityType").val() == id) {
                $("#commodityType_" + id).removeClass("active")
            } else {
                $("#commodityType_" + id).addClass("active")
            }
            $("#CommodityType").val(id);
            doSearch();
        }
        function setPromotionType(id) {
            if ($("#PromotionType").val() == id) {
                $("#promotionType_" + id).removeClass("active")
            } else {
                $("#promotionType_" + id).addClass("active")
            }
            $("#PromotionType").val(id);
            $("#products").html("");
            doSearch();
        }
        function doSearch() {
            $.ajax({
                type: "POST",
                url: "Shop/GetCommodities",
                data: {
                    pageIndex: pageIndex,
                    pageSize: pageSize,
                    commodityType: $("#CommodityType").val(),
                    promotionType: $("#PromotionType").val()
                },
                success: function (data) {
                    $.each(data, function (index, value) {
                        $("#products").append(buildHtml(value));
                    });
                    scollflag = true;
                    pageIndex++;
                }
            });
        };
        function buildHtml(model) {
            var date1 = usp.ParseUTCDateToDate(model.CreateTime);
            var date2 = new Date();
            return '<div class="newsstyle  col-sm-4 col-md-3">' +
                        '<div class="thumbnail ">' +
                            '<div class="thumbpic">' +
                                '<a href="' + model.TBKLink + '" target="_blank">' +
                                    '<img src="' + model.Picture + '" alt="' + model.Name + '">' +
                                    '@*<div id="intro" class="pdetail">' +
                                        '@item.Name' +
                                    '</div>*@' +
                                '</a>' +
                            '</div>' +
                            '<div class="caption">' +
                                '<a href="' + model.TBKLink + '" target="_blank">' +
                                    '<h2>' + model.Name + '</h2>' +
                                        '<a href="' + model.CouponLink + '" target="_blank">' +
                                            '<p class="tpriceinfo">' +
                                                  model.CouponDenomination +
                                            '</p>' +
                                        '</a>' +
                                '</a>' +
                                '<p class="tsrcinfo">' + model.Type + '&nbsp;&nbsp;<span class="infos pull-right">' + usp.getDateDiff(date1, date2) + ' 前</span></p>' +
                                '<p class="binfo">' +
                                    '<a href="/mall/?mall=淘宝" target="_blank" class="mallinfo">' + model.PlatformName + '</a>' +
                                    '<a id="' + model.ID + '" href="javascript:void(0);" onclick="javascript: void (0);" class="favor">' +
                                        '&nbsp&nbsp<i class="glyphicon glyphicon-thumbs-up" title="赞"></i>' +
                                    '</a>   @*<span class="cnum"></span>*@' +
                                    '@*<a href="" class="btn md_btn" role="button" target="_blank">购买</a>*@' +
                                    '<span style="float:right">' +
                                        '<button class="btn btn-default btn-sm btn-danger" onclick="window.open(\'' + model.CouponLink + '\');">领卷</button>&nbsp' +
                                        '<button class="btn btn-default btn-sm btn-danger" onclick="window.open(\'' + model.TBKLink +'\');">购买</button>' +
                                    '</span>' +
                                '</p>' +
                            '</div>' +
                        '</div>' +
                    '</div>';
        }
        var scollflag = true;
        $(function () {
            $("#navleftbar > div >a").click(function () {
                $("#navleftbar > div >a").removeClass("active");
                $(this).addClass("active");
            })

            window.onscroll = function () {
                var marginBot = 0;
                if (document.documentElement.scrollTop) {
                    marginBot = document.documentElement.scrollHeight - document.documentElement.clientHeight - (document.documentElement.scrollTop + document.body.scrollTop);
                } else {
                    marginBot = document.body.scrollHeight - document.body.scrollTop - document.body.clientHeight;
                }
                if (marginBot <= 0) {
                    if (scollflag) {
                        scollflag = false;
                        doSearch();

                    }
                }
            }
          
            doSearch();
        });


    </script>
</body>

</html>

@*@section Scripts {
        @Scripts.Render("~/Js/Usp")
        <script src="~/Static/Js/usp/usp.shop.js"></script>
        <script>
            $(function () {
                usp.init();
                if (window.top != window) {
                    window.top.document.location.href = window.location.href;
                }
            });
        </script>
    }*@
